<html>
  <head>
    <title>Instagroup chat</title>
  </head>
  <body>
    <script src="APISend.js"></script>
    <iframe style="border: 0;" src="https://script.google.com/macros/s/AKfycbwVuOdPyFYP55KpR_V17w6il1ehkLWttoS6gxpbM8nzu4LRj4B9SxgTlsg5K5B8lMCI7w/exec?serverid=@instagroup~betafeature~welcome" width="600" height="650" id="framed"></iframe>
    <input type="text" id="serverid">
    <button onclick="loadmessages()" id="serverloadbutton">Load server</button>
    <button onclick="popup()">Open Popup window</button>
    <div id="sendmsg">
      <input type="text" id="usernamebox" placeholder="username">
      <input type="password" id="passwordbox" placeholder="password">
      <button onclick="save_login()">save</button>
      <input type="text" id="messagebox" placeholder="message">
      <button onclick="sendtoapi()">send</button>
    </div>
    <style>
      input {
        padding:10px;
        border-radius:10px;
      }
      body {
        background-color: grey;
        color: white;
      }
      button {

        /* remove default behavior */
        appearance:none;
        -webkit-appearance:none;

        /* usual styles */
        padding:10px;
        border-color: black;
        background-color:#3F51B5;
        color:#fff;
        font-weight:600;
        border-radius:5px;
        width:100%;

      }
    </style>
    <script>
      var inputserv = document.getElementById('serverid')
      var serverbutton = document.getElementById('serverloadbutton')
      var fream = document.getElementById('framed')
      var usernametosave = document.getElementById('usernamebox')
      var passwordtosave = document.getElementById('passwordbox')
      var mesgbox = document.getElementById('messagebox')
      fream.width = window.innerWidth
      function loadmessages() {
        fream.setAttribute("src", "https://script.google.com/macros/s/AKfycbwVuOdPyFYP55KpR_V17w6il1ehkLWttoS6gxpbM8nzu4LRj4B9SxgTlsg5K5B8lMCI7w/exec?serverid="+inputserv.value) 
        serverbutton.setAttribute("hidden", "true")
        inputserv.setAttribute("hidden", "true")
        document.cookie = "serveronload="+inputserv.value
      }
      function popup() {
        window.open('chatpopup.html', 'test','popup=true,height=600,width=650,resizable=yes,scrollbars=yes,toolbar=no,menubar=yes');
      }
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }
      function save_login() {
        document.cookie = "usernamesaved="+usernametosave.value
        document.cookie = "passwordsaved="+passwordtosave.value
        usernametosave.setAttribute('hidden', "true")
        passwordtosave.setAttribute('hidden', "true")
      }
      function sendtoapi() {
        sendMsgUser(getCookie("usernamesaved"), getCookie("passwordsaved"), mesgbox.value, getCookie("serveronload"))
        var waittimer = wait(3500)
        if (waittimer==true) {
          window.open(window.location.href, "_top")
        }
      }
      function wait(milleseconds) {
        var timer = 0
        while (timer<milleseconds) {
          timer++
        }
        return true
      }
     </script>
  </body>
</html>
